                                                                                 local game=game or    
                                                                        getgenv().game ;local Players=game:GetService(  
                                                                    "Players");local lp=Players.LocalPlayer;local mouse=lp:       
                                                                GetMouse();local F1_KEY=112;local colors={background=Color3.fromRGB(15, 
                                                            15,15),header=Color3.fromRGB(25,25,25),accent=Color3.fromRGB(255,255,255),    
                                                          button=Color3.fromRGB(35,35,35),buttonHover=Color3.fromRGB(55,55,55),buttonActive 
                                                        =Color3.fromRGB(70,130,255),text=Color3.fromRGB(255,255,255),textDim=Color3.fromRGB(  
                                                      180,180,180),closeBtn=Color3.fromRGB(255,100,100)};local UI_WIDTH=380;local               
                                                    BUTTON_START_X=270;local ROW_HEIGHT=38;local scrollIndex=1;local maxVisible=6;local           
                                                  globalScrollIndex=1;local globalMaxVisible=6;local sortByDistance=false;local                     
                                                  lastGlobalPlayerCount=0;local function V2(x,y) return Vector2.new(math.floor(x or 0 ),math.floor(y  
                                                or 0 ));end local ui={visible=true,dragging=false,dragOffset=V2(0,0),basePos=V2(100,100)};local invUI={ 
                                                visible=false,target=nil,dragging=false,dragOffset=V2(0,0),basePos=V2(500,100),size=V2(250,200)};local    
                                              globalUI={visible=false,dragging=false,dragOffset=V2(0,0),basePos=V2(550,100),size=V2(350,500)};local         
                                              function isMouseOver(pos,size) local mx=mouse.X;local my=mouse.Y;return (mx>=pos.X) and (mx<=(pos.X + size.X) 
                                            ) and (my>=pos.Y) and (my<=(pos.Y + size.Y)) ;end local function getNames(p) if  not p then return "??","??";end  
                                            local uName=tostring(p.Name);local dName=p.DisplayName;if ((dName==uName) or (dName==nil)) then if (p.Character and 
                                           p.Character:FindFirstChild("Humanoid")) then local humName=p.Character.Humanoid.DisplayName;if (humName and (humName~= 
                                          "")) then dName=humName;end end end if ((dName==nil) or (dName=="")) then dName=uName;end return dName,uName;end local    
                                          function getDistanceValue(p) if ( not p or  not lp) then return 999999;end local pChar=p.Character;local myChar=lp.         
                                          Character;if ( not pChar or  not myChar) then return 999999;end local pRoot=pChar:FindFirstChild("HumanoidRootPart") or     
                                        pChar:FindFirstChild("Torso") or pChar:FindFirstChild("Head") ;local myRoot=myChar:FindFirstChild("HumanoidRootPart") or myChar 
                                        :FindFirstChild("Torso") or myChar:FindFirstChild("Head") ;if ( not   --[[==============================]]pRoot or  not myRoot)   
                                        then return 999999;end local pos1=pRoot.Position;local pos2 --[[============================================]]=myRoot.Position;if 
                                         ( not pos1 or  not pos2) then return 999999;end local  --[[======================================================]]x1,y1,z1=pos1.X 
                                      ,pos1.Y,pos1.Z;local x2,y2,z2=pos2.X,pos2.Y,pos2.Z;if --[[==========================================================]] ( not x1 or  not 
                                       x2) then return 999999;end local dist=math.sqrt((( --[[==============================================================]]x2-x1)^2) + ((  
                                      y2-y1)^2) + ((z2-z1)^2) );return dist;end local     --[[================================================================]]function        
                                      getDistance(p) local dist=getDistanceValue(p);if (  --[[==================================================================]]dist==999999) 
                                       then return "N/A";end return math.floor(dist)   .. --[[==================================================================]] "m" ;end local   
                                     function normalizeName(name) if  not name then       --[[====================================================================]]return "";end 
                     return string.lower(name:gsub("%s+",""));end local function          --[[====================================================================]]shouldIgnore(   
              name) if  not name then return true;end local n=normalizeName(name);if ((n  --[[======================================================================]]=="phone") or 
             (n=="fist")) then return true;end if ((n=="head") or (n=="torso") or (n==    --[[======================================================================]]"leftarm") or 
           (n=="rightarm") or (n=="leftleg") or (n=="rightleg")) then return true;end if  --[[======================================================================]]((n==         
        "uppertorso") or (n=="lowertorso") or (n=="leftupperarm") or (n=="leftlowerarm")  --[[======================================================================]]or (n==       
        "lefthand") or (n=="rightupperarm") or (n=="rightlowerarm") or (n=="righthand")   --[[======================================================================]]or (n==       
      "leftupperleg") or (n=="leftlowerleg") or (n=="leftfoot") or (n=="rightupperleg")   --[[======================================================================]]or (n==       
      "rightlowerleg") or (n=="rightfoot") or (n=="humanoidrootpart")) then return true;end --[[==================================================================]] return false;  
      end local function getEquippedTool(player) if ( not player or  not player.Character)  --[[================================================================]]then return       
    "None";end local equippedTool=player.Character:FindFirstChildOfClass("Tool");if (       --[[==============================================================]]equippedTool and  
      not shouldIgnore(equippedTool.Name)) then return equippedTool.Name;end return "None";   --[[==========================================================]]end local function  
    scanInventory(player) local foundItems={};local function scan(container) local ok,ch=pcall( --[[====================================================]]function() return       
    container:GetChildren();end);if ok then for _,item in ipairs(ch) do if (item:IsA("Tool") and  --[[==============================================]]  not shouldIgnore(item.  
    Name) and  not item:FindFirstChild("HumanoidRootPart")) then foundItems[item.Name]=(foundItems[   --[[====================================]]item.Name] or 0) + 1 ;end end 
     end end local backpack=player:FindFirstChild("Backpack");if backpack then scan(backpack);end if      --[[========================]]player.Character then local           
    equippedTool=player.Character:FindFirstChildOfClass("Tool");if (equippedTool and  not shouldIgnore(equippedTool.Name)) then foundItems[equippedTool.Name]=(foundItems[  
  equippedTool.Name] or 0) + 1 ;end end return foundItems;end local function TeleportTo(targetPlayer) if  not targetPlayer then return;end local tChar=targetPlayer.      
  Character;local myChar=lp.Character;if ( not tChar or  not myChar) then return;end local tRoot=tChar:FindFirstChild("HumanoidRootPart") or tChar:FindFirstChild(      
  "Torso") ;local myRoot=myChar:FindFirstChild("HumanoidRootPart") or myChar:FindFirstChild("Torso") ;if (tRoot and myRoot) then myRoot.Position=tRoot.Position + Vector3 
  .new(0,0,3) ;end end local elements={};local playerButtons={};local scrollButtons={};local bottomButtons={};local bg=Drawing.new("Square");bg.Filled=true;bg.Color=     
  colors.background;bg.Visible=true;bg.ZIndex=1;table.insert(elements,bg);local header=Drawing.new("Square");header.Filled=true;header.Color=colors.header;header.Visible 
  =true;header.ZIndex=2;table.insert(elements,header);local title=Drawing.new("Text");title.Text="PLAYERS";title.Color=colors.accent;title.Outline=true;title.Visible=    
  true;title.ZIndex=3;title.Size=20;table.insert(elements,title);local playerCount=Drawing.new("Text");playerCount.Text="(0/0)";playerCount.Color=colors.textDim;         
  playerCount.Outline=true;playerCount.Visible=true;playerCount.ZIndex=3;playerCount.Size=14;table.insert(elements,playerCount);local invElements={};local invItems={};   
  local invBg=Drawing.new("Square");invBg.Filled=true;invBg.Color=colors.background;invBg.Visible=false;invBg.ZIndex=10;table.insert(invElements,invBg);local invHeader=  
  Drawing.new("Square");invHeader.Filled=true;invHeader.Color=colors.header;invHeader.Visible=false;invHeader.ZIndex=11;table.insert(invElements,invHeader);local         
  invTitle=Drawing.new("Text");invTitle.Text="INVENTORY";invTitle.Color=colors.text;invTitle.Outline=true;invTitle.Visible=false;invTitle.ZIndex=12;table.insert(         
  invElements,invTitle);local invCloseBg=Drawing.new("Square");invCloseBg.Size=V2(20,20);invCloseBg.Color=colors.header;invCloseBg.Filled=true;invCloseBg.Visible=false;    
  invCloseBg.ZIndex=13;table.insert(invElements,invCloseBg);local invCloseText=Drawing.new("Text");invCloseText.Text="X";invCloseText.Color=colors.closeBtn;invCloseText.   
  Outline=true;invCloseText.Visible=false;invCloseText.ZIndex=14;table.insert(invElements,invCloseText);local globalElements={};local globalItems={};local globalPlayerData 
  ={};local globalScrollButtons={};local globalBg=Drawing.new("Square");globalBg.Filled=true;globalBg.Color=colors.background;globalBg.Visible=false;globalBg.ZIndex=20;    
  table.insert(globalElements,globalBg);local globalHeader=Drawing.new("Square");globalHeader.Filled=true;globalHeader.Color=colors.header;globalHeader.Visible=false;      
  globalHeader.ZIndex=21;table.insert(globalElements,globalHeader);local globalTitle=Drawing.new("Text");globalTitle.Text="SERVER INVENTORY";globalTitle.Color=colors.      
  accent;globalTitle.Outline=true;globalTitle.Visible=false;globalTitle.ZIndex=22;table.insert(globalElements,globalTitle);local globalCloseBg=Drawing.new("Square");       
  globalCloseBg.Size=V2(20,20);globalCloseBg.Color=colors.header;globalCloseBg.Filled=true;globalCloseBg.Visible=false;globalCloseBg.ZIndex=23;table.insert(globalElements, 
  globalCloseBg);local globalCloseText=Drawing.new("Text");globalCloseText.Text="X";globalCloseText.Color=colors.closeBtn;globalCloseText.Outline=true;globalCloseText.     
  Visible=false;globalCloseText.ZIndex=24;table.insert(globalElements,globalCloseText);local function createButton(text,offsetX,offsetY,width,height) local btn={};btn.bg=  
  Drawing.new("Square");btn.bg.Size=V2(width,height);btn.bg.Color=colors.button;btn.bg.Filled=true;btn.bg.Visible=true;btn.bg.ZIndex=3;btn.text=Drawing.new("Text");btn.    
  text.Text=text;btn.text.Color=colors.text;btn.text.Outline=true;btn.text.Visible=true;btn.text.ZIndex=5;btn.text.Size=16;btn.offsetX=offsetX;btn.offsetY=offsetY;return   
  btn;end local upBtn=createButton("<",UI_WIDTH-50 ,8,20,20);upBtn.action="up";table.insert(scrollButtons,upBtn);local downBtn=createButton(">",UI_WIDTH-25 ,8,20,20);      
  downBtn.action="down";table.insert(scrollButtons,downBtn);local globalUpBtn=createButton("<",0,0,20,20);globalUpBtn.action="up";globalUpBtn.bg.ZIndex=25;globalUpBtn.   
  text.ZIndex=26;table.insert(globalScrollButtons,globalUpBtn);local globalDownBtn=createButton(">",0,0,20,20);globalDownBtn.action="down";globalDownBtn.bg.ZIndex=25;    
  globalDownBtn.text.ZIndex=26;table.insert(globalScrollButtons,globalDownBtn);local closestBtn=createButton("CLOSEST: OFF",15,0,UI_WIDTH-30 ,30);table.insert(           
    bottomButtons,closestBtn);local allInvBtn=createButton("SHOW EVERYONE\'S INVENTORY",15,0,UI_WIDTH-30 ,30);table.insert(bottomButtons,allInvBtn);local lastPlayerCount 
    =0;local function getSortedPlayerList() local children=Players:GetChildren();local playerList={};for _,p in ipairs(children) do if ((p.ClassName=="Player") and (p~=  
    lp)) then table.insert(playerList,p);end end if sortByDistance then table.sort(playerList,function(a,b) return getDistanceValue(a)<getDistanceValue(b) ;end);else     
    table.sort(playerList,function(a,b) local nameA,_=getNames(a);local nameB,_=getNames(b);return string.lower(nameA)<string.lower(nameB) ;end);end return playerList;   
      end local function updatePlayerList() if  not ui.visible then return;end local playerList=getSortedPlayerList();local totalPlayers= #playerList;if (totalPlayers> 
      0) then local maxScroll=math.max(1,(totalPlayers-maxVisible) + 1 );scrollIndex=math.max(1,math.min(scrollIndex,maxScroll));else scrollIndex=1;end if (            
      totalPlayers~=lastPlayerCount) then lastPlayerCount=totalPlayers;for _,item in pairs(playerButtons) do item.tpBtn.bg:Remove();item.tpBtn.text:Remove();item.      
        viewBtn.bg:Remove();item.viewBtn.text:Remove();item.label:Remove();if item.distLabel then item.distLabel:Remove();end if item.equippedLabel then item.          
        equippedLabel:Remove();end end playerButtons={};local currentY=50;local count=0;for i=scrollIndex,math.min(totalPlayers,(scrollIndex + maxVisible) -1 ) do      
        local player=playerList[i];local label=Drawing.new("Text");label.Color=colors.text;label.Outline=true;label.Visible=true;label.ZIndex=4;local distLabel=Drawing 
          .new("Text");distLabel.Color=colors.textDim;distLabel.Outline=true;distLabel.Visible=true;distLabel.ZIndex=4;local equippedLabel=Drawing.new("Text");       
            equippedLabel.Color=colors.textDim;equippedLabel.Outline=true;equippedLabel.Visible=true;equippedLabel.ZIndex=4;local btnY=currentY + 5 ;local tpBtn=     
              createButton("TP",BUTTON_START_X,btnY,40,25);local viewBtn=createButton("INV",BUTTON_START_X + 50 ,btnY,40,25);table.insert(playerButtons,{tpBtn=tpBtn, 
                viewBtn=viewBtn,label=label,distLabel=distLabel,equippedLabel=equippedLabel,target=player,labelOffsetY=currentY + 2 ,distOffsetY=currentY + 18 });    
                  currentY=currentY + ROW_HEIGHT ;count=count + 1 ;end end local count=0;for i=scrollIndex,math.min(totalPlayers,(scrollIndex + maxVisible) -1 ) do 
                       count=count + 1 ;local idx=count;if playerButtons[idx] then local player=playerList[i];playerButtons[idx].target=player;local dName,uName=   
                                  getNames(player);if (dName==uName) then playerButtons[idx].label.Text=uName;else playerButtons[idx].label.Text=string.format(     
                                      "%s (@%s)",dName,uName);end playerButtons[idx].distLabel.Text=getDistance(player);local equipped=getEquippedTool(player);     
                                      playerButtons[idx].equippedLabel.Text=" | "   .. equipped ;           end end local endRange=(scrollIndex + count) -1 ;if (   
                                      count==0) then endRange=0;end playerCount.Text=string.format(         "(%d-%d/%d)",scrollIndex,endRange,totalPlayers);local 
                                       listHeight=50 + (maxVisible * ROW_HEIGHT) ;if (count<                maxVisible) then listHeight=50 + (count * ROW_HEIGHT) 
                                       ;end local h=listHeight + 80 ;bg.Size=V2(UI_WIDTH,h);header.         Size=V2(UI_WIDTH,40);closestBtn.offsetY=listHeight +  
                                      5 ;allInvBtn.offsetY=listHeight + 40 ;end local function                updateInvViewer() if (invUI.visible and invUI.      
                                      target) then for _,e in pairs(invElements) do e.Visible=true;           end local player=invUI.target;local dName,uName=    
                                      getNames(player);invTitle.Text=string.upper(dName)   ..                 "\'S ITEMS" ;local foundItems=scanInventory(      
                                        player);local itemList={};for name,count in pairs(                    foundItems) do table.insert(itemList,{name=name,  
                                        count=count});end local itemIndex=1;for _,itemData in                   ipairs(itemList) do if  not invItems[itemIndex] 
                                         then invItems[itemIndex]=Drawing.new("Text");invItems[                 itemIndex].Color=colors.textDim;invItems[     
                                        itemIndex].Outline=true;invItems[itemIndex].ZIndex=13;end                invItems[itemIndex].Text=((itemData.count>1) 
                                         and string.format("%s (x%d)",itemData.name,itemData.                     count)) or itemData.name ;invItems[       
                                        itemIndex].Visible=true;itemIndex=itemIndex + 1 ;end if (                  #itemList==0) then if  not invItems[1]   
                                          then invItems[1]=Drawing.new("Text");invItems[1].Color=                   colors.textDim;invItems[1].Outline=   
                                          true;invItems[1].ZIndex=13;end invItems[1].Text=                            "- Empty -";invItems[1].Visible 
                                            =true;itemIndex=2;end for i=itemIndex, #invItems do                          invItems[i].Visible=     
                                            false;end local currentY=invUI.basePos.Y + 50 ;                                   local       
                                              startX=invUI.basePos.X + 15 ;for i=1,         
                                                itemIndex-1  do if (invItems[i] and       
                                                    invItems[i].Visible) then invItems[ 
                                                          i].Position=V2(startX,  


currentY);currentY=currentY + 20 ;end end local h=math.max(100,(currentY-invUI.basePos.Y) + 10 );invUI.size=V2(200,h);invBg.Size=invUI.size;invBg.Position=invUI.basePos;invHeader.Size=V2(invUI.size.X,40);invHeader.Position=invUI.basePos;invTitle.Position=invUI.basePos + V2(10,12) ;invCloseBg.Position=invUI.basePos + V2(invUI.size.X-25 ,5) ;invCloseText.Position=invUI.basePos + V2(invUI.size.X-19 ,8) ;invCloseBg.Visible=true;invCloseText.Visible=true;else for _,e in pairs(invElements) do e.Visible=false;end for _,t in pairs(invItems) do t.Visible=false;end invCloseBg.Visible=false;invCloseText.Visible=false;end end local function rebuildGlobalViewer() local playerList=getSortedPlayerList();local totalPlayers= #playerList;if (totalPlayers>0) then globalScrollIndex=math.max(1,math.min(globalScrollIndex,totalPlayers));else globalScrollIndex=1;end for _,t in pairs(globalItems) do t:Remove();end globalItems={};globalPlayerData={};if  not globalUI.visible then return;end local itemIndex=1;local endIndex=math.min(totalPlayers,(globalScrollIndex + globalMaxVisible) -1 );for i=globalScrollIndex,endIndex do local player=playerList[i];local foundItems=scanInventory(player);local dName,uName=getNames(player);local pNameDisplay=((dName==uName) and dName) or string.format("%s (@%s)",dName,uName) ;local pHeader=Drawing.new("Text");pHeader.Color=colors.accent;pHeader.Outline=true;pHeader.Visible=true;pHeader.ZIndex=23;table.insert(globalItems,pHeader);table.insert(globalPlayerData,{player=player,headerText=pHeader,baseName=pNameDisplay,itemStartIndex=itemIndex + 1 });itemIndex=itemIndex + 1 ;local hasItems=false;for name,count in pairs(foundItems) do hasItems=true;local txt=Drawing.new("Text");txt.Text=((count>1) and string.format(" - %s (x%d)",name,count)) or (" - "   .. name) ;txt.Color=colors.textDim;txt.Outline=true;txt.Visible=true;txt.ZIndex=23;table.insert(globalItems,txt);itemIndex=itemIndex + 1 ;end if  not hasItems then local txt=Drawing.new("Text");txt.Text=" - Empty";txt.Color=Color3.fromRGB(150,150,150);txt.Outline=true;txt.Visible=true;txt.ZIndex=23;table.insert(globalItems,txt);itemIndex=itemIndex + 1 ;end end lastGlobalPlayerCount=totalPlayers;globalTitle.Text=string.format("SERVER INV (%d-%d/%d)",globalScrollIndex,endIndex,totalPlayers);local currentY=globalUI.basePos.Y + 50 ;local startX=globalUI.basePos.X + 15 ;for i,data in ipairs(globalPlayerData) do local dist=getDistance(data.player);local equipped=getEquippedTool(data.player);data.headerText.Text=string.format("%s [%s] [%s]:",data.baseName,dist,equipped);data.headerText.Position=V2(startX,currentY);currentY=currentY + 18 ;for j=data.itemStartIndex, #globalItems do if (globalPlayerData[i + 1 ] and (j>=globalPlayerData[i + 1 ].itemStartIndex)) then break;end if globalItems[j] then globalItems[j].Position=V2(startX + 10 ,currentY);currentY=currentY + 16 ;end end currentY=currentY + 8 ;end local h=math.max(150,(currentY-globalUI.basePos.Y) + 10 );globalUI.size=V2(350,h);globalBg.Size=globalUI.size;globalBg.Position=globalUI.basePos;globalHeader.Size=V2(globalUI.size.X,40);globalHeader.Position=globalUI.basePos;globalTitle.Position=globalUI.basePos + V2(60,12) ;globalCloseBg.Position=globalUI.basePos + V2(5,5) ;globalCloseText.Position=globalUI.basePos + V2(11,8) ;globalCloseBg.Visible=true;globalCloseText.Visible=true;local gWidth=globalUI.size.X;globalUpBtn.bg.Position=V2((globalUI.basePos.X + gWidth) -50 ,globalUI.basePos.Y + 8 );globalUpBtn.text.Position=V2((globalUI.basePos.X + gWidth) -45 ,globalUI.basePos.Y + 11 );globalUpBtn.bg.Visible=true;globalUpBtn.text.Visible=true;globalDownBtn.bg.Position=V2((globalUI.basePos.X + gWidth) -25 ,globalUI.basePos.Y + 8 );globalDownBtn.text.Position=V2((globalUI.basePos.X + gWidth) -20 ,globalUI.basePos.Y + 11 );globalDownBtn.bg.Visible=true;globalDownBtn.text.Visible=true;end local function updateGlobalViewerSmooth() if  not globalUI.visible then return;end local playerList=getSortedPlayerList();if ( #playerList~=lastGlobalPlayerCount) then rebuildGlobalViewer();return;end for _,data in ipairs(globalPlayerData) do if (data.player and data.headerText) then local dist=getDistance(data.player);local equipped=getEquippedTool(data.player);data.headerText.Text=string.format("%s [%s] [%s]:",data.baseName,dist,equipped);end end local currentY=globalUI.basePos.Y + 50 ;local startX=globalUI.basePos.X + 15 ;for i,data in ipairs(globalPlayerData) do data.headerText.Position=V2(startX,currentY);currentY=currentY + 18 ;for j=data.itemStartIndex, #globalItems do if (globalPlayerData[i + 1 ] and (j>=globalPlayerData[i + 1 ].itemStartIndex)) then break;end if globalItems[j] then globalItems[j].Position=V2(startX + 10 ,currentY);currentY=currentY + 16 ;end end currentY=currentY + 8 ;end globalBg.Position=globalUI.basePos;globalHeader.Position=globalUI.basePos;globalTitle.Position=globalUI.basePos + V2(60,12) ;globalCloseBg.Position=globalUI.basePos + V2(5,5) ;globalCloseText.Position=globalUI.basePos + V2(11,8) ;local gWidth=globalUI.size.X;globalUpBtn.bg.Position=V2((globalUI.basePos.X + gWidth) -50 ,globalUI.basePos.Y + 8 );globalUpBtn.text.Position=V2((globalUI.basePos.X + gWidth) -45 ,globalUI.basePos.Y + 11 );globalDownBtn.bg.Position=V2((globalUI.basePos.X + gWidth) -25 ,globalUI.basePos.Y + 8 );globalDownBtn.text.Position=V2((globalUI.basePos.X + gWidth) -20 ,globalUI.basePos.Y + 11 );end local function updateGlobalViewer() for _,e in pairs(globalElements) do e.Visible=globalUI.visible;end for _,t in pairs(globalItems) do t.Visible=globalUI.visible;end globalUpBtn.bg.Visible=globalUI.visible;globalUpBtn.text.Visible=globalUI.visible;globalDownBtn.bg.Visible=globalUI.visible;globalDownBtn.text.Visible=globalUI.visible;if globalUI.visible then rebuildGlobalViewer();else globalCloseBg.Visible=false;globalCloseText.Visible=false;end end local function updatePositions() bg.Position=ui.basePos;header.Position=ui.basePos;title.Position=ui.basePos + V2(147,10) ;playerCount.Position=ui.basePos + V2(8,10) ;for _,item in pairs(scrollButtons) do item.bg.Position=V2(ui.basePos.X + item.offsetX ,ui.basePos.Y + item.offsetY );item.text.Position=V2(ui.basePos.X + item.offsetX + 5 ,ui.basePos.Y + item.offsetY + 3 );end for _,item in pairs(playerButtons) do item.tpBtn.bg.Position=V2(ui.basePos.X + item.tpBtn.offsetX ,ui.basePos.Y + item.tpBtn.offsetY );item.tpBtn.text.Position=V2(ui.basePos.X + item.tpBtn.offsetX + 10 ,ui.basePos.Y + item.tpBtn.offsetY + 6 );item.viewBtn.bg.Position=V2(ui.basePos.X + item.viewBtn.offsetX ,ui.basePos.Y + item.viewBtn.offsetY );item.viewBtn.text.Position=V2(ui.basePos.X + item.viewBtn.offsetX + 8 ,ui.basePos.Y + item.viewBtn.offsetY + 6 );item.label.Position=V2(ui.basePos.X + 15 ,ui.basePos.Y + item.labelOffsetY );if item.distLabel then item.distLabel.Position=V2(ui.basePos.X + 15 ,ui.basePos.Y + item.distOffsetY );end if item.equippedLabel then item.equippedLabel.Position=V2(ui.basePos.X + 60 ,ui.basePos.Y + item.distOffsetY );end end closestBtn.bg.Position=V2(ui.basePos.X + closestBtn.offsetX ,ui.basePos.Y + closestBtn.offsetY );closestBtn.text.Position=V2(ui.basePos.X + closestBtn.offsetX + 35 ,ui.basePos.Y + closestBtn.offsetY + 8 );allInvBtn.bg.Position=V2(ui.basePos.X + allInvBtn.offsetX ,ui.basePos.Y + allInvBtn.offsetY );allInvBtn.text.Position=V2(ui.basePos.X + allInvBtn.offsetX + 20 ,ui.basePos.Y + allInvBtn.offsetY + 8 );end updatePlayerList();updatePositions();updateInvViewer();updateGlobalViewer();spawn(function() while true do wait(0.02);if ui.visible then for _,item in pairs(playerButtons) do if item.target then if item.distLabel then item.distLabel.Text=getDistance(item.target);end if item.equippedLabel then local equipped=getEquippedTool(item.target);item.equippedLabel.Text=" | "   .. equipped ;end end end end end end);spawn(function() while true do wait(0.05);if globalUI.visible then updateGlobalViewerSmooth();end end end);spawn(function() while true do wait();if ui.visible then if ui.dragging then ui.basePos=V2(mouse.X-ui.dragOffset.X ,mouse.Y-ui.dragOffset.Y );updatePositions();end if (invUI.visible and invUI.dragging) then invUI.basePos=V2(mouse.X-invUI.dragOffset.X ,mouse.Y-invUI.dragOffset.Y );updateInvViewer();end if (globalUI.visible and globalUI.dragging) then globalUI.basePos=V2(mouse.X-globalUI.dragOffset.X ,mouse.Y-globalUI.dragOffset.Y );updateGlobalViewerSmooth();end end end end);spawn(function() while true do wait(0.016);if ui.visible then if (isMouseOver(header.Position,header.Size) and ismouse1pressed() and  not ui.dragging and  not invUI.dragging and  not globalUI.dragging) then local clickingScroll=false;for _,btn in pairs(scrollButtons) do if isMouseOver(btn.bg.Position,btn.bg.Size) then clickingScroll=true;end end if  not clickingScroll then ui.dragging=true;ui.dragOffset=V2(mouse.X-ui.basePos.X ,mouse.Y-ui.basePos.Y );end end if  not ismouse1pressed() then ui.dragging=false;end if invUI.visible then if (isMouseOver(invHeader.Position,invHeader.Size) and ismouse1pressed() and  not invUI.dragging and  not ui.dragging) then invUI.dragging=true;invUI.dragOffset=V2(mouse.X-invUI.basePos.X ,mouse.Y-invUI.basePos.Y );end if  not ismouse1pressed() then invUI.dragging=false;end end if globalUI.visible then if (isMouseOver(globalHeader.Position,globalHeader.Size) and ismouse1pressed() and  not globalUI.dragging) then local clickingGlobalScroll=false;if isMouseOver(globalUpBtn.bg.Position,globalUpBtn.bg.Size) then clickingGlobalScroll=true;end if isMouseOver(globalDownBtn.bg.Position,globalDownBtn.bg.Size) then clickingGlobalScroll=true;end if isMouseOver(globalCloseBg.Position,globalCloseBg.Size) then clickingGlobalScroll=true;end if  not clickingGlobalScroll then globalUI.dragging=true;globalUI.dragOffset=V2(mouse.X-globalUI.basePos.X ,mouse.Y-globalUI.basePos.Y );end end if  not ismouse1pressed() then globalUI.dragging=false;end end if ( not ui.dragging and  not invUI.dragging and  not globalUI.dragging) then for _,item in pairs(playerButtons) do if isMouseOver(item.tpBtn.bg.Position,item.tpBtn.bg.Size) then item.tpBtn.bg.Color=colors.buttonHover;else item.tpBtn.bg.Color=colors.button;end if isMouseOver(item.viewBtn.bg.Position,item.viewBtn.bg.Size) then item.viewBtn.bg.Color=colors.buttonHover;else item.viewBtn.bg.Color=colors.button;end end for _,item in pairs(scrollButtons) do if isMouseOver(item.bg.Position,item.bg.Size) then item.bg.Color=colors.buttonHover;else item.bg.Color=colors.button;end end if isMouseOver(closestBtn.bg.Position,closestBtn.bg.Size) then closestBtn.bg.Color=colors.buttonHover;else closestBtn.bg.Color=(sortByDistance and colors.buttonActive) or colors.button ;end if isMouseOver(allInvBtn.bg.Position,allInvBtn.bg.Size) then allInvBtn.bg.Color=colors.buttonHover;else allInvBtn.bg.Color=colors.button;end if (invUI.visible and isMouseOver(invCloseBg.Position,invCloseBg.Size)) then invCloseBg.Color=colors.buttonHover;else invCloseBg.Color=colors.header;end if (globalUI.visible and isMouseOver(globalCloseBg.Position,globalCloseBg.Size)) then globalCloseBg.Color=colors.buttonHover;else globalCloseBg.Color=colors.header;end if globalUI.visible then if isMouseOver(globalUpBtn.bg.Position,globalUpBtn.bg.Size) then globalUpBtn.bg.Color=colors.buttonHover;else globalUpBtn.bg.Color=colors.button;end if isMouseOver(globalDownBtn.bg.Position,globalDownBtn.bg.Size) then globalDownBtn.bg.Color=colors.buttonHover;else globalDownBtn.bg.Color=colors.button;end end end end end end);spawn(function() local lastMouseState=false;local clickStartPos=V2(0,0);while true do wait(0.016);if ui.visible then local currentMouseState=ismouse1pressed();if (currentMouseState and  not lastMouseState) then clickStartPos=V2(mouse.X,mouse.Y);end if ( not currentMouseState and lastMouseState) then local clickEndPos=V2(mouse.X,mouse.Y);local dragDistance=math.sqrt(((clickEndPos.X-clickStartPos.X)^2) + ((clickEndPos.Y-clickStartPos.Y)^2) );if (dragDistance<5) then local clickHandled=false;if globalUI.visible then if isMouseOver(globalUpBtn.bg.Position,globalUpBtn.bg.Size) then local playerList=getSortedPlayerList();local totalPlayers= #playerList;if (globalScrollIndex>1) then globalScrollIndex=math.max(1,globalScrollIndex-globalMaxVisible );rebuildGlobalViewer();end clickHandled=true;elseif isMouseOver(globalDownBtn.bg.Position,globalDownBtn.bg.Size) then local playerList=getSortedPlayerList();local totalPlayers= #playerList;if ((totalPlayers>globalMaxVisible) and (((globalScrollIndex + globalMaxVisible) -1)<totalPlayers)) then globalScrollIndex=math.min(totalPlayers,globalScrollIndex + globalMaxVisible );rebuildGlobalViewer();end clickHandled=true;end end if  not clickHandled then if (invUI.visible and isMouseOver(invCloseBg.Position,invCloseBg.Size)) then invUI.visible=false;invUI.target=nil;updateInvViewer();clickHandled=true;elseif (globalUI.visible and isMouseOver(globalCloseBg.Position,globalCloseBg.Size)) then globalUI.visible=false;updateGlobalViewer();clickHandled=true;end end if  not clickHandled then for _,item in pairs(scrollButtons) do if isMouseOver(item.bg.Position,item.bg.Size) then local playerList=getSortedPlayerList();local totalPlayers= #playerList;if (item.action=="up") then scrollIndex=math.max(1,scrollIndex-1 );end if (item.action=="down") then if (totalPlayers>0) then local maxScroll=math.max(1,(totalPlayers-maxVisible) + 1 );scrollIndex=math.min(maxScroll,scrollIndex + 1 );end end updatePlayerList();updatePositions();clickHandled=true;end end end if  not clickHandled then for _,item in pairs(playerButtons) do if isMouseOver(item.tpBtn.bg.Position,item.tpBtn.bg.Size) then TeleportTo(item.target);clickHandled=true;elseif isMouseOver(item.viewBtn.bg.Position,item.viewBtn.bg.Size) then if (invUI.visible and (invUI.target==item.target)) then invUI.visible=false;invUI.target=nil;else invUI.target=item.target;invUI.visible=true;invUI.basePos=ui.basePos + V2(UI_WIDTH + 10 ,0) ;end updateInvViewer();clickHandled=true;end end end if  not clickHandled then if isMouseOver(closestBtn.bg.Position,closestBtn.bg.Size) then sortByDistance= not sortByDistance;closestBtn.text.Text=(sortByDistance and "CLOSEST: ON") or "CLOSEST: OFF" ;scrollIndex=1;globalScrollIndex=1;lastPlayerCount=0;lastGlobalPlayerCount=0;updatePlayerList();updatePositions();if globalUI.visible then rebuildGlobalViewer();end clickHandled=true;end end if  not clickHandled then if isMouseOver(allInvBtn.bg.Position,allInvBtn.bg.Size) then globalUI.visible= not globalUI.visible;if globalUI.visible then globalUI.basePos=V2(ui.basePos.X-(globalUI.size.X + 10) ,ui.basePos.Y);globalScrollIndex=1;end updateGlobalViewer();clickHandled=true;end end end end lastMouseState=currentMouseState;end end end);spawn(function() while true do wait(0.2);if (ui.visible and  not ui.dragging) then updatePlayerList();updatePositions();end if (invUI.visible and  not invUI.dragging) then updateInvViewer();end end end);spawn(function() while true do wait(0.05);if iskeypressed(F1_KEY) then ui.visible= not ui.visible;if  not ui.visible then invUI.visible=false;globalUI.visible=false;updateInvViewer();updateGlobalViewer();end local vis=ui.visible;for _,e in pairs(elements) do e.Visible=vis;end for _,item in pairs(playerButtons) do item.tpBtn.bg.Visible=vis;item.tpBtn.text.Visible=vis;item.viewBtn.bg.Visible=vis;item.viewBtn.text.Visible=vis;item.label.Visible=vis;if item.distLabel then item.distLabel.Visible=vis;end if item.equippedLabel then item.equippedLabel.Visible=vis;end end for _,item in pairs(scrollButtons) do item.bg.Visible=vis;item.text.Visible=vis;end closestBtn.bg.Visible=vis;closestBtn.text.Visible=vis;allInvBtn.bg.Visible=vis;allInvBtn.text.Visible=vis;while iskeypressed(F1_KEY) do wait();end end end end);print("Success - Buttery smooth dragging!");